name: Hello World Workflow

on:
  push:
    branches:
      - main  # Triggers the action when there's a push to the main branch
  pull_request:  # Also runs on pull requests
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest  # The environment where the action runs

    steps:
      - name: Checkout the code
        uses: actions/checkout@v3  # Check out the code in the repository

      # - name: Make script executable
      #   run: chmod +x ./scripts/script.sh

      # - name: Say Hello World
      #   run: ./scripts/script.sh qa b2cpolicies
      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: build-artifacts
          path: . 
  dev-deploy:
    runs-on: ubuntu-latest
    environment: dev
    needs: build
    steps:
      # Step 1: Checkout the code
      - name: Download Hello World artifact
        uses: actions/download-artifact@v3
        with:
          name: build-artifacts
          path: ./artifact
      - name: Make script executable
        run: chmod +x ./artifact/scripts/script.sh

      - name: Say Hello World
        run: echo "$vars.clientId"

      - name: Say Hello World
        run: ./artifact/scripts/script.sh dev ./artifact/b2cpolicies

      - name: 'Upload TrustFrameworkBase Policy'
        uses: azure-ad-b2c/deploy-trustframework-policy@v3
        with:
          folder: "./dev"
          tenant: ${{ vars.tenant }}
          clientId: ${{ vars.clientId }}
          clientSecret: ${{ vars.clientSecret }}
